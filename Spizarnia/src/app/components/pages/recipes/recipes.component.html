<div class="header-container">
  <div class="title">Moje Przepisy</div>
  <div class="search-bar">
    <input
      type="text"
      placeholder="Wyszukaj przepis..."
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
    />
    <button class="action-button" (click)="onSearch()">
      Szukaj
    </button>
    <button class="action-button" (click)="resetSearch()">
      Resetuj
    </button>
    <button class="action-button" (click)="showDialog = true">
      Dodaj Przepis
    </button>
  </div>
</div>

<!-- Okienko dialogowe dodawania przepisu -->
<div class="dialog" *ngIf="showDialog">
  <div class="dialog-content">
    <h2>Dodaj nowy przepis</h2>
    <form (ngSubmit)="addRecipe()">
      <div class="form-group">
        <label for="recipeName">Nazwa</label>
        <input
          id="recipeName"
          type="text"
          [(ngModel)]="newRecipe.name"
          name="name"
          required
          placeholder="Nazwa przepisu"
        />
      </div>
      <div class="form-group">
        <label for="recipeIngredients">Składniki (oddzielone przecinkiem)</label>
        <input
          id="recipeIngredients"
          type="text"
          [(ngModel)]="newRecipe.ingredients"
          name="ingredients"
          required
          placeholder="Np. Mąka, Jajka, Cukier"
        />
      </div>
      <div class="dialog-actions">
        <button type="submit" class="action-button">Dodaj</button>
        <button type="button" class="action-button" (click)="showDialog = false">Anuluj</button>
      </div>
    </form>
  </div>
</div>


<!-- Lista przepisów -->
<div class="recipes-container">
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let recipe">{{ recipe.id }}</td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Nazwa</th>
      <td mat-cell *matCellDef="let recipe">{{ recipe.name }}</td>
    </ng-container>

    <ng-container matColumnDef="ingredients">
      <th mat-header-cell *matHeaderCellDef>Składniki</th>
      <td mat-cell *matCellDef="let recipe">
        <span *ngFor="let ingredient of recipe.ingredients; let isLast = last">
          {{ ingredient.productModel?.name || ingredient.quantity }}<span *ngIf="!isLast">, </span>
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="finished">
      <th mat-header-cell *matHeaderCellDef>Gotowy</th>
      <td mat-cell *matCellDef="let recipe">{{ recipe.finished ? 'Tak' : 'Nie' }}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Akcje</th>
      <td mat-cell *matCellDef="let recipe">
        <button mat-button (click)="deleteRecipe(recipe.id)">Usuń</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <form (ngSubmit)="addRecipe()">
    <mat-form-field>
      <input matInput placeholder="Nazwa przepisu" [(ngModel)]="newRecipe.name" name="name" />
    </mat-form-field>

    <mat-form-field>
      <mat-label>Składniki</mat-label>
      <mat-select [(ngModel)]="newRecipe.ingredients" name="ingredients" multiple>
        <mat-option *ngFor="let ingredient of availableIngredients" [value]="ingredient.id">
          {{ ingredient.productModel?.name || ingredient.quantity }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button type="submit">Dodaj Przepis</button>
  </form>
</div>

