<div class="header-container">
  <div class="title">Moje Przepisy</div>
  <div class="search-bar">
    <input
      type="text"
      placeholder="Wyszukaj przepis..."
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
    />
    <button class="action-button" (click)="onSearch()">
      Szukaj
    </button>
    <button class="action-button" (click)="resetSearch()">
      Resetuj
    </button>
    <button class="action-button" (click)="showDialog = true">
      Dodaj Przepis
    </button>
  </div>
</div>

<!-- Okienko dialogowe dodawania przepisu -->
<div class="dialog" *ngIf="showDialog">
  <div class="dialog-content">
    <h2>Dodaj nowy przepis</h2>
    <form (ngSubmit)="addRecipe()">
      <div class="form-group">
        <label for="recipeName">Nazwa</label>
        <input
          id="recipeName"
          type="text"
          [(ngModel)]="newRecipe.name"
          name="name"
          required
          placeholder="Nazwa przepisu"
        />
      </div>
      <div class="form-group">
        <label for="recipeIngredients">Składniki (oddzielone przecinkiem)</label>
        <input
          id="recipeIngredients"
          type="text"
          [(ngModel)]="newRecipe.ingredients"
          name="ingredients"
          required
          placeholder="Np. Mąka, Jajka, Cukier"
        />
      </div>
      <div class="dialog-actions">
        <button type="submit" class="action-button">Dodaj</button>
        <button type="button" class="action-button" (click)="showDialog = false">Anuluj</button>
      </div>
    </form>
  </div>
</div>


<!-- Lista przepisów -->
<div class="recipes-container">
  <div *ngIf="dataSource && dataSource.data && dataSource.data.length > 0; else noRecipes">
    @for (recipe of dataSource.data; track recipe) {
    <mat-accordion>
      <mat-expansion-panel [ngStyle]="recipeStyles[recipe.id].style">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ recipe.name }}
          </mat-panel-title>
        </mat-expansion-panel-header>
          Składniki:
          @for(ingredient of recipe.ingredients; track ingredient){
            <p>{{ingredient.productModel.name}} Ilość: {{ingredient.quantity}}</p>
          }
          @if(recipeStyles[recipe.id].isExecutable)
          {
            <button (click)="executeRecipe(recipe)">Wykonaj przepis</button>
          }
      </mat-expansion-panel>
    </mat-accordion>
  }
  </div>

  <!-- Wiadomość, gdy brak przepisów -->
  <ng-template #noRecipes>
    <div class="no-data">Brak przepisów do wyświetlenia.</div>
  </ng-template>
</div>